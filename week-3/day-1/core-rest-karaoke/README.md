# REST/CRUD и Караоке

## Общие сведения

Перед выполнением данной задачи рассмотри условные обозначения для типов запросов (например, `GET` и `POST`) и пути в соответствии с `CRUD` (например, `/dogs/:id/edit`).

- [REST][wikipedia rest]
- [CRUD][wikipedia crud] - создание, чтение, обновление и удаление.

Что мы обычно делаем с данными? Мы вносим новые записи в базу данных, читаем их из базы данных, обновляем их значения и удаляем их из базы данных. Чтобы инициировать эти функции в веб-приложении, нам нужно делать запросы к определенным маршрутам(routes) для обработки данных: маршрут для вставки данных в базу данных, маршрут для получения всех записей из базы данных, маршрут для обновления записи и т. д.

| Description                        | Behavior | Request Type | Request Path     |
| ---------------------------------- | -------- | ------------ | ---------------- |
| Insert a dog record                | Create   | POST         | `/dogs`          |
| Select all dogs records            | Read     | GET          | `/dogs`          |
| Select one dog record              | Read     | GET          | `/dogs/:id`      |
| Form for creating a new dog record | Read     | GET          | `/dogs/new`      |
| Form for editing a dog record      | Read     | GET          | `/dogs/:id/edit` |
| Update a dog record                | Update   | PATCH        | `/dogs/:id`      |
| Delete a dog record                | Delete   | DELETE       | `/dogs/:id`      |

_Рисунок 1_. Шаблонные типы запросов и пути по CRUD.

Представь себе приложение для "усыновления" собак. Если пользователь хочет внести в список новую собаку для усыновления, пользователю необходимо перейти на страницу с формой для предоставления информации о собаке. Предположим, что для перехода на страницу с формой пользователь нажимает ссылку «Добавить собаку». Следуя условным обозначениям, нажатие этой ссылки должно отправить запрос `GET` на путь `/dogs/new`. Ответом на этот запрос станет возвращение страницы с формой. Когда пользователь заполнит форму и нажмет кнопку отправки, то должен отправиться запрос `POST` на путь `/dogs`. Для других функций также есть условные обозначения (см. Таблицу 1).

Эти условные обозначения являются частью подхода к структурированию приложения, известного как [REST][wikipedia rest].

### Определение обработчиков маршрутов

```javascript
router.get('/dogs/:id', (req, res) => {
  // Implement route handler
});

router.put('/dogs/:id', (req, res) => {
  // Implement route handler
});

router.delete('/dogs/:id', (req, res) => {
  // Implement route handler
});
```

_Рисунок 1_. Определение обработчиков маршрутов для запросов `PUT` и `DELETE`.

Однако в случае работы с html-формами есть некоторые нюансы. Вспомните, какие методы отправки запросов поддерживает форма в HTML.

Мы рассмотрели с вами пример написания REST API. Перейдем к созданию реального приложения.

---

## Караоке!

### Внимание

Попробуйте реализовать все основные `CRUD` операции роутами, основанными на REST-принципах.

В проекте по-прежнему могут оставаться «обычные» роуты для отрисовки страниц. Если такие роуты переиспользуют какие-то данные, то не дублируйте функционал обращения к БД. Как вариант, можно вынести переиспользуемое обращение к БД в статические методы Sequelize-модели.

Если появились сомнения по принципу построения взаимодействия роутов с БД, не стесняйтесь обсудить возникшие вопросы с коллегами. А также не забывайте про преподавателей.

### Release 0: Изучение рабочего приложения

Давайте запустим рабочее приложение и изучим его. Это простое одностраничное `CRUD`-приложение для регистрации на караоке. Пользователь вводит свое имя и название песни, которую он будет исполнять, и запись добавляется в список. Записи можно просматривать, редактировать и удалять.

### Release 1: Перепроектирование маршрутов

Тебе нужно перепроектировать маршруты в этом приложении, чтобы всё было в соответствии с `REST`. Пропиши правильные пути и убери `CRUD`-глаголы из названий роутов. Также, тебе необходимо обновить все формы, ссылки, пути перенаправления, и т.д. Постарайся максимально использовать `fetch()`, где это возможно. и не забудь про методы `PUT` и `DELETE`

### Release 2: Fetch и AJAX API

А теперь используй `fetch()` для удаления каждой записи (delete), получения деталей записи (details), изменения записи (edit) и добавления новой (Add new song to Karaoke). Начни с удаления - это проще всего. Не забудь, что так как это AJAX-запросы теперь ты сможешь использовать HTTP-методы `PUT` и `DELETE`. Можешь попробовать использовать модальные окна для добавления, деталей и изменения записи ([HTML Dialog Element][html dialog element] или [Bootstarp Modal][bootstarp modal]).

[wikipedia crud]: https://ru.wikipedia.org/wiki/CRUD
[wikipedia rest]: https://ru.wikipedia.org/wiki/REST
[html dialog element]: https://developer.mozilla.org/ru/docs/Web/API/HTMLDialogElement
[bootstarp modal]: https://getbootstrap.com/docs/5.2/components/modal/
